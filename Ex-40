import string
from collections import Counter
from itertools import permutations

# English letter frequency (descending order)
ENGLISH_FREQ_ORDER = 'ETAOINSHRDLCUMWFGYPBVKJXQZ'

def clean_text(text):
    return ''.join(c.upper() for c in text if c.isalpha())

def get_frequency_order(text):
    counter = Counter(clean_text(text))
    most_common = [pair[0] for pair in counter.most_common()]
    return ''.join(most_common)

def generate_substitution_maps(cipher_freq_order):
    # Map cipher letters to English frequency letters
    return [dict(zip(cipher_freq_order, perm)) for perm in permutations(ENGLISH_FREQ_ORDER[:len(cipher_freq_order)])]

def apply_substitution(ciphertext, sub_map):
    result = ''
    for c in ciphertext.upper():
        if c in sub_map:
            result += sub_map[c]
        else:
            result += c
    return result

def score_text(text):
    # Score based on how well the letter frequency matches English
    counter = Counter(c for c in text if c in string.ascii_uppercase)
    total = sum(counter.values())
    if total == 0:
        return 0
    freq = {char: (count / total) * 100 for char, count in counter.items()}
    score = sum(abs(freq.get(char, 0) - ENGLISH_FREQ_ORDER.index(char)) for char in freq)
    return score

def frequency_attack(ciphertext, top_n=10):
    cipher_freq_order = get_frequency_order(ciphertext)
    maps = generate_substitution_maps(cipher_freq_order[:6])  # Limit to top 6 for performance
    candidates = []
    for sub_map in maps:
        plaintext = apply_substitution(ciphertext, sub_map)
        score = score_text(plaintext)
        candidates.append((plaintext, score))
    candidates.sort(key=lambda x: x[1])
    return candidates[:top_n]

# User interface
if __name__ == "__main__":
    cipher_input = input("Enter the monoalphabetic ciphertext: ")
    top_n = int(input("How many top plaintexts to show? (e.g., 10): "))
    results = frequency_attack(cipher_input, top_n)

    print("\nTop possible plaintexts:")
    for i, (text, score) in enumerate(results, 1):
        print(f"{i}. Score={score:.2f} | Plaintext: {text}")
